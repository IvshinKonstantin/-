using System;

namespace Lab4_Tasks6_7
{
    public class RightTriangle
    {
        private double _a;
        private double _b;

        public double A
        {
            get => _a;
            set
            {
                if (value <= 0)
                    throw new ArgumentException("Длина катета должна быть положительной");
                _a = value;
            }
        }

        public double B
        {
            get => _b;
            set
            {
                if (value <= 0)
                    throw new ArgumentException("Длина катета должна быть положительной");
                _b = value;
            }
        }

        // Конструкторы
        public RightTriangle() : this(1.0, 1.0) { }

        public RightTriangle(double a, double b)
        {
            if (a <= 0 || b <= 0)
                throw new ArgumentException("Длины катетов должны быть положительными");
            _a = a;
            _b = b;
        }

        public RightTriangle(RightTriangle other)
        {
            if (other == null)
                throw new ArgumentNullException(nameof(other));
            _a = other._a;
            _b = other._b;
        }

        // Метод вычисления площади (Задание 6)
        public double CalculateArea()
        {
            return (_a * _b) / 2.0;
        }

        // Вычисление гипотенузы
        public double CalculateHypotenuse()
        {
            return Math.Sqrt(_a * _a + _b * _b);
        }

        // Проверка существования треугольника
        public bool Exists()
        {
            return _a > 0 && _b > 0;
        }

        // Перегрузка ToString()
        public override string ToString()
        {
            return $"RightTriangle [a={_a:F2}, b={_b:F2}, площадь={CalculateArea():F2}, гипотенуза={CalculateHypotenuse():F2}]";
        }

        // ЗАДАНИЕ 7: Перегрузка операций

        // Унарные операции ++ и --
        public static RightTriangle operator ++(RightTriangle triangle)
        {
            if (triangle == null) 
                throw new ArgumentNullException(nameof(triangle));
            
            double newA = triangle._a * 2;
            double newB = triangle._b * 2;
            
            if (double.IsInfinity(newA) || double.IsInfinity(newB))
                throw new OverflowException("Результат операции превышает допустимые значения");
                
            return new RightTriangle(newA, newB);
        }

        public static RightTriangle operator --(RightTriangle triangle)
        {
            if (triangle == null) 
                throw new ArgumentNullException(nameof(triangle));
            
            double newA = triangle._a / 2;
            double newB = triangle._b / 2;
            
            if (newA <= 0 || newB <= 0)
                throw new InvalidOperationException("Результат операции делает катеты неположительными");
                
            return new RightTriangle(newA, newB);
        }

        // Явное приведение к double (площадь)
        public static explicit operator double(RightTriangle triangle)
        {
            if (triangle == null) 
                throw new ArgumentNullException(nameof(triangle));
            return triangle.Exists() ? triangle.CalculateArea() : -1;
        }

        // Неявное приведение к bool (существование треугольника)
        public static implicit operator bool(RightTriangle triangle)
        {
            return triangle?.Exists() ?? false;
        }

        // Бинарные операции сравнения <= и >=
        public static bool operator <=(RightTriangle t1, RightTriangle t2)
        {
            if (t1 is null || t2 is null) 
                return false;
            return t1.CalculateArea() <= t2.CalculateArea();
        }

        public static bool operator >=(RightTriangle t1, RightTriangle t2)
        {
            if (t1 is null || t2 is null) 
                return false;
            return t1.CalculateArea() >= t2.CalculateArea();
        }

        // Операции равенства
        public static bool operator ==(RightTriangle t1, RightTriangle t2)
        {
            if (ReferenceEquals(t1, t2)) 
                return true;
            if (t1 is null || t2 is null) 
                return false;
            return Math.Abs(t1._a - t2._a) < 0.001 && Math.Abs(t1._b - t2._b) < 0.001;
        }

        public static bool operator !=(RightTriangle t1, RightTriangle t2)
        {
            return !(t1 == t2);
        }

        public override bool Equals(object obj)
        {
            return obj is RightTriangle other && this == other;
        }

        public override int GetHashCode()
        {
            return HashCode.Combine(_a, _b);
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("=== ЛАБОРАТОРНАЯ РАБОТА №4 - ЗАДАНИЯ 6-7 ===\n");
            Console.WriteLine("Класс RightTriangle с перегрузкой операций\n");

            while (true)
            {
                Console.WriteLine("Выберите действие:");
                Console.WriteLine("1 - Создать треугольник");
                Console.WriteLine("2 - Демонстрация операций (Задание 7)");
                Console.WriteLine("0 - Выход");
                
                var choice = Console.ReadLine();
                
                switch (choice)
                {
                    case "1":
                        CreateAndTestTriangle();
                        break;
                    case "2":
                        DemonstrateOperations();
                        break;
                    case "0":
                        return;
                    default:
                        Console.WriteLine("Неверный выбор!");
                        break;
                }
                
                Console.WriteLine("\nНажмите любую клавишу для продолжения...");
                Console.ReadKey();
                Console.Clear();
            }
        }

        static void CreateAndTestTriangle()
        {
            try
            {
                Console.WriteLine("\n=== СОЗДАНИЕ ТРЕУГОЛЬНИКА ===\n");
                
                Console.WriteLine("Введите длину катета a:");
                var a = double.Parse(Console.ReadLine());
                
                Console.WriteLine("Введите длину катета b:");
                var b = double.Parse(Console.ReadLine());
                
                var triangle = new RightTriangle(a, b);
                
                Console.WriteLine($"\nСоздан треугольник: {triangle}");
                Console.WriteLine($"Площадь: {triangle.CalculateArea():F2}");
                Console.WriteLine($"Гипотенуза: {triangle.CalculateHypotenuse():F2}");
                Console.WriteLine($"Треугольник существует: {triangle.Exists()}");
                
                // Демонстрация приведения типов
                double area = (double)triangle;
                bool exists = triangle;
                Console.WriteLine($"Явное приведение к double: {area:F2}");
                Console.WriteLine($"Неявное приведение к bool: {exists}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка: {ex.Message}");
            }
        }

        static void DemonstrateOperations()
        {
            try
            {
                Console.WriteLine("\n=== ДЕМОНСТРАЦИЯ ОПЕРАЦИЙ ===\n");
                
                // Создаем два треугольника для демонстрации
                Console.WriteLine("Создание первого треугольника:");
                Console.Write("Катет a1: ");
                var a1 = double.Parse(Console.ReadLine());
                Console.Write("Катет b1: ");
                var b1 = double.Parse(Console.ReadLine());
                var triangle1 = new RightTriangle(a1, b1);
                
                Console.WriteLine("\nСоздание второго треугольника:");
                Console.Write("Катет a2: ");
                var a2 = double.Parse(Console.ReadLine());
                Console.Write("Катет b2: ");
                var b2 = double.Parse(Console.ReadLine());
                var triangle2 = new RightTriangle(a2, b2);
                
                Console.WriteLine($"\nТреугольник 1: {triangle1}");
                Console.WriteLine($"Треугольник 2: {triangle2}");
                
                // Демонстрация унарных операций
                Console.WriteLine("\n--- Унарные операции ---");
                var incremented = triangle1++;
                Console.WriteLine($"triangle1++ : {incremented}");
                
                var decremented = triangle1--;
                Console.WriteLine($"triangle1-- : {decremented}");
                
                // Демонстрация бинарных операций сравнения
                Console.WriteLine("\n--- Бинарные операции сравнения ---");
                Console.WriteLine($"triangle1 <= triangle2 : {triangle1 <= triangle2}");
                Console.WriteLine($"triangle1 >= triangle2 : {triangle1 >= triangle2}");
                Console.WriteLine($"triangle1 == triangle2 : {triangle1 == triangle2}");
                Console.WriteLine($"triangle1 != triangle2 : {triangle1 != triangle2}");
                
                // Демонстрация приведения типов
                Console.WriteLine("\n--- Приведение типов ---");
                Console.WriteLine($"Площадь triangle1: {(double)triangle1:F2}");
                Console.WriteLine($"Площадь triangle2: {(double)triangle2:F2}");
                Console.WriteLine($"triangle1 существует: {(bool)triangle1}");
                Console.WriteLine($"triangle2 существует: {(bool)triangle2}");
                
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка: {ex.Message}");
            }
        }
    }
}
