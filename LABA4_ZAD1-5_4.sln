using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

public static class CollectionTasks
{
    // ==================== ЗАДАНИЕ 1: List (Вариант 4) ====================
    // Удалить из списка L за каждым вхождением элемента E один элемент, 
    // если такой есть, и он отличен от E

    public static List<int> RemoveAfterElement(List<int> L, int E)
    {
        List<int> result = new List<int>();

        for (int i = 0; i < L.Count; i++)
        {
            result.Add(L[i]);

            // Если текущий элемент равен E и есть следующий элемент
            if (L[i] == E && i + 1 < L.Count && L[i + 1] != E)
            {
                i++; // Пропускаем следующий элемент
            }
        }

        return result;
    }

    // ==================== ЗАДАНИЕ 2: LinkedList (Вариант 4) ====================
    // Определить, есть ли в списке L хотя бы один элемент, который равен следующему за ним
    // (по кругу) элементу (первый элемент считать следующим для последнего)

    public static bool HasEqualNeighborsCircular(LinkedList<int> L)
    {
        if (L.Count == 0) return false;

        var current = L.First;
        while (current != null)
        {
            var next = current.Next ?? L.First; // По кругу
            if (current.Value == next.Value)
                return true;
            current = current.Next;
        }

        return false;
    }

    // ==================== ЗАДАНИЕ 3: HashSet (Вариант 4) ====================
    // Есть перечень стран, популярных у туристов. Определить для каждой страны, 
    // какие из них посетили все n туристов, какие — некоторые из туристов, 
    // и какие — никто из туристов

    public static void AnalyzeTouristCountries(HashSet<string> allCountries,
                                              Dictionary<string, HashSet<string>> touristVisits)
    {
        Console.WriteLine("\n=== АНАЛИЗ ПОСЕЩЕНИЯ СТРАН ТУРИСТАМИ ===");

        // Страны, которые посетили все туристы
        var visitedByAll = new HashSet<string>(allCountries);
        foreach (var tourist in touristVisits.Values)
        {
            visitedByAll.IntersectWith(tourist);
        }
        Console.WriteLine($"Страны, посещенные всеми туристами: {string.Join(", ", visitedByAll)}");

        // Страны, которые посетили некоторые туристы
        var visitedBySome = new HashSet<string>();
        foreach (var tourist in touristVisits.Values)
        {
            visitedBySome.UnionWith(tourist);
        }
        visitedBySome.IntersectWith(allCountries);
        Console.WriteLine($"Страны, посещенные некоторыми туристами: {string.Join(", ", visitedBySome)}");

        // Страны, которые не посетил никто
        var visitedByNone = new HashSet<string>(allCountries);
        visitedByNone.ExceptWith(visitedBySome);
        Console.WriteLine($"Страны, не посещенные никем: {string.Join(", ", visitedByNone)}");
    }

    // ==================== ЗАДАНИЕ 4: HashSet (Вариант 4) ====================
    // Файл содержит текст на русском языке. Напечатать в алфавитном порядке 
    // все глухие согласные буквы, которые не входят ровно в одно слово

    private static readonly HashSet<char> DeafConsonants = new HashSet<char>
    {
        'п', 'ф', 'к', 'т', 'ш', 'с', 'х', 'ц', 'ч', 'щ'
    };

    public static void FindDeafConsonantsNotInOneWord(string filename)
    {
        if (!File.Exists(filename))
        {
            Console.WriteLine($"Файл {filename} не существует");
            return;
        }

        string text = File.ReadAllText(filename).ToLower();

        // Разбиваем текст на слова
        char[] separators = { ' ', ',', '.', '!', '?', ';', ':', '\n', '\r', '\t' };
        string[] words = text.Split(separators, StringSplitOptions.RemoveEmptyEntries);

        // Словарь для подсчета в скольких словах встречается каждая буква
        Dictionary<char, int> letterCount = new Dictionary<char, int>();

        foreach (string word in words)
        {
            var uniqueLettersInWord = new HashSet<char>();
            foreach (char c in word)
            {
                if (char.IsLetter(c) && DeafConsonants.Contains(c))
                {
                    uniqueLettersInWord.Add(c);
                }
            }

            foreach (char letter in uniqueLettersInWord)
            {
                if (letterCount.ContainsKey(letter))
                    letterCount[letter]++;
                else
                    letterCount[letter] = 1;
            }
        }

        // Находим буквы, которые не входят ровно в одно слово
        var resultLetters = letterCount.Where(pair => pair.Value != 1)
                                      .Select(pair => pair.Key)
                                      .OrderBy(c => c)
                                      .ToList();

        Console.WriteLine($"\nГлухие согласные, которые не входят ровно в одно слово: {string.Join(", ", resultLetters)}");
    }

    // ==================== ЗАДАНИЕ 5: Dictionary (Вариант 4) ====================
    // Абитуриенты тестирование - не допущенные к экзаменам в первом потоке

    public static void FindFailedAbiturients(string filename)
    {
        if (!File.Exists(filename))
        {
            Console.WriteLine($"Файл {filename} не существует");
            return;
        }

        var failedAbiturients = new List<string>();

        string[] lines = File.ReadAllLines(filename);
        if (lines.Length == 0) return;

        int n = int.Parse(lines[0]);

        for (int i = 1; i <= n && i < lines.Length; i++)
        {
            string[] parts = lines[i].Split(' ');
            if (parts.Length < 4) continue;

            string surname = parts[0];
            string name = parts[1];
            int score1 = int.Parse(parts[2]);
            int score2 = int.Parse(parts[3]);

            // Не допускаются те, у кого хотя бы один предмет < 30 баллов
            if (score1 < 30 || score2 < 30)
            {
                failedAbiturients.Add($"{surname} {name}");
            }
        }

        failedAbiturients.Sort();

        Console.WriteLine("\nАбитуриенты, не допущенные к экзаменам в первом потоке:");
        foreach (string abiturient in failedAbiturients)
        {
            Console.WriteLine(abiturient);
        }
    }

    // ==================== ВСПОМОГАТЕЛЬНЫЕ МЕТОДЫ ====================

    // Метод для заполнения файла тестовыми данными для задания 5
    public static void CreateTestFileForTask5(string filename)
    {
        string[] testData = {
            "5",
            "Иванов Петр 45 25",
            "Петрова Анна 35 40",
            "Сидоров Иван 28 32",
            "Козлова Мария 45 45",
            "Николаев Алексей 20 15"
        };

        File.WriteAllLines(filename, testData);
        Console.WriteLine($"Создан тестовый файл: {filename}");
    }

    // Метод для заполнения файла тестовым текстом для задания 4
    public static void CreateTestFileForTask4(string filename)
    {
        string testText = "программирование компьютер алгоритм структура функция переменная " +
                         "константа оператор цикл массив список словарь множество " +
                         "интерфейс класс объект метод свойство поле конструктор " +
                         "наследование полиморфизм инкапсуляция абстракция исключение";

        File.WriteAllText(filename, testText);
        Console.WriteLine($"Создан тестовый файл: {filename}");
    }

    // Метод для демонстрации всех заданий
    public static void DemonstrateAllTasks()
    {
        Console.WriteLine("=== ДЕМОНСТРАЦИЯ РЕШЕНИЯ ЗАДАНИЙ 1-5 ===");

        // Задание 1
        Console.WriteLine("\n--- Задание 1: List ---");
        List<int> list1 = new List<int> { 1, 2, 3, 2, 4, 5, 2, 6 };
        int E = 2;
        Console.WriteLine($"Исходный список: {string.Join(", ", list1)}");
        Console.WriteLine($"Элемент E: {E}");
        List<int> result1 = RemoveAfterElement(list1, E);
        Console.WriteLine($"Результат: {string.Join(", ", result1)}");

        // Задание 2  
        Console.WriteLine("\n--- Задание 2: LinkedList ---");
        LinkedList<int> list2 = new LinkedList<int>(new[] { 1, 2, 3, 3, 4, 5 });
        Console.WriteLine($"Список: {string.Join(", ", list2)}");
        bool hasEqual = HasEqualNeighborsCircular(list2);
        Console.WriteLine($"Есть равные соседи по кругу: {hasEqual}");

        // Задание 3
        Console.WriteLine("\n--- Задание 3: HashSet ---");
        HashSet<string> allCountries = new HashSet<string> { "Франция", "Италия", "Испания", "Германия", "Великобритания" };
        var touristVisits = new Dictionary<string, HashSet<string>>
        {
            ["Турист1"] = new HashSet<string> { "Франция", "Италия", "Испания" },
            ["Турист2"] = new HashSet<string> { "Италия", "Германия" },
            ["Турист3"] = new HashSet<string> { "Франция", "Испания", "Великобритания" }
        };
        AnalyzeTouristCountries(allCountries, touristVisits);

        // Задание 4
        Console.WriteLine("\n--- Задание 4: HashSet (текстовый файл) ---");
        string filename4 = "text_task4.txt";
        CreateTestFileForTask4(filename4);
        FindDeafConsonantsNotInOneWord(filename4);

        // Задание 5
        Console.WriteLine("\n--- Задание 5: Dictionary (текстовый файл) ---");
        string filename5 = "abiturients_task5.txt";
        CreateTestFileForTask5(filename5);
        FindFailedAbiturients(filename5);
    }
}

class Program
{
    static void Main(string[] args)
    {
        CollectionTasks.DemonstrateAllTasks();

        Console.WriteLine("\nНажмите любую клавишу для выхода...");
        Console.ReadKey();
    }
}
